# 组管理  终端命令

> 创建组、删除组 的终端命令都需要通过`sudo` 来执行



| 命令                         | 作用                      |
| ---------------------------- | ------------------------- |
| `groupadd`                   | 添加组                    |
| `groupdel`                   | 删除组                    |
| `cat  /etc/group`            | 确认组信息                |
| `chgrp 组名  文件/目录名`    | 修改文件/目录的所属组     |
| `chgrp -R 组名  文件/目录名` | 递归修改文件/目录的所属组 |



> 组信息保存在 `/etc/group` 文件中
>
> `/etc` 目录是专门用来保存  ** 系统配置信息** 的目录





+ 在实际应用中，可以预先针对  组  设置好权限， 然后**将不同的用户添加到对应的组中**， 从而**不用依次为每一个用户设置权限**



现在进行一个实例  

第一步： 添加一个组` sudo groupadd dev`

第二步： 通过`cat /etc/group`查看是否成功添加dev这个组

第三步： 通过`ls -l` 查看，通常会使用文件的用户名来作为文件的组名，现在我们使用`sudo chgrp -R dev 文件名或目录名`来修改文件或目录的所属组

第四步：再次通过`ls -l` 再次查看，这个文件名或目录名的所属组已经修改为dev 





# 用户管理 终端命令

> 创建、删除、修改其他用户密码都需要通过`sudo`  root 这个用户执行

## 01 创建用户/设置密码/删除用户

| 命令                            | 作用         | 说明                                                         |
| ------------------------------- | ------------ | ------------------------------------------------------------ |
| `useradd -m -g 组名 新建用户名` | 添加新用户   | `-m`自动创建用户家目录<br />`-g`指定用户所在组，否则会创建一个和用户同名的小组 |
| `passwd 用户名`                 | 设置用户密码 | 如果是普通用户，可以用`passwd`直接修改自己的密码             |
| `userdel -r 用户名`             | 删除用户     | `-r`选项会自动删除用户家目录                                 |
| `cat /etc/passwd \|grep 用户名` | 确认用户信息 | 新建用户后，新建信息会保存在` /etc/passwd`文件中             |



创建一个新用户时，必须使用两个命令，一个是`useradd -m -g 组名 新建用户名` ，另一个是` passwd 用户名` 来设置用户密码



> + 创建新用户时，如果忘记加上`-m`自动创建用户家目录，最简单的方法就是删除用户，重新创建
>
> + 创建新用户时，默认会 创建一个和用户名重名的组名
>
> + 用户信息保存在`/etc/passwd`文件中



## 02 查看用户信息

| 命令        | 作用                                        |
| ----------- | ------------------------------------------- |
| `id 用户名` | 查看用户UID（用户代号）和GID（组代号） 信息 |
| `who`       | 查看**当前所有登录**的用户列表              |
| `whoami`    | 查看**当前登录**用户的账户名                |

 如果直接输入`id`是查看当前登录账户的信息

### passwd 文件

`/etc/passwd` 文件存放的是用户信息，由6个分号组成的7个信息，分别是

1. 用户名
2. 密码(x，表示加密的密码）
3. UID （用户标识）
4. GID（组标识）
5. 用户全名，如果没有就用用户名代替
6. 家目录
7. 登录使用的Shell，就是登录之后，使用的终端命令，`ubuntu`默认是`dash`，注意是`dash`，不是`bash`，`dash`使用起来可能不太方便

#### 实例

shell中输入`id lisi`    输出的是  ` uid=1002(lisi) gid=1001(dev) 组=1001(dev)`

shell中输入`cat /etc/passwd| grep lisi` 命令来查看`lisi`这个用户的用户信息， 输出的是 ` lisi:x:1002:1001::/home/lisi:` 这个表示用户名`lisi`，`x`表示密码但是不显示，1002是用户代号，1001是组代号，后面有两个冒号之间是空的，根据视频中说的是用户全名，后面是用户的家目录

shell中输入`cat /etc/group |grep dev` 来查看dev这个组的信息    输出的是 `dev:x:1001:`  说明组代号是1001



### usermod

[关于主组和附加组](https://www.bilibili.com/video/BV1ex411x7Em?p=74&spm_id_from=pageDriver)

+ `usermod`可以用来设置用户的**主组/附加组**和**登录shell**，命令格式如下
+ 主组：通常在新建用户时指定，在`/etc/passwd`的第4列**GID对应的组**，在创建用户的时候，使用`-g`指定，如果没有指定，则默认创建一个和用户名一样的组就是主组
+ 附加组：在`etc/group`中最后一列表示该组的用户列表，用于指定用户的**附加权限**

> 在设置了用户的附加组之后，需要重新登录才能生效



以一个例子来说明主组和附加组

在shell中直接输入`id`命令，返回的是

 `uid=1000(gray) gid=1000(gray) 组=1000(gray) ,4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)`

从这里面可以看出，对于gray这个用户，主组是`gray`，主组代号是1000，主组之后有很多附加组比如`4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)`

```
# 修改用户的主组(passwd中的GID)
usermod -g 组名 用户名

# 修改用户的附加组
usermod -G 组名 用户名

# 修改用户登录shell
usermod -s /bin/bash 用户名	

```

在创建一个用户之后，我们很少会更改用户的主组，大部分情况下我们会修改用户所在的附加组

> 默认使用`useradd`添加的用户是没有权限使用`sudo`以`root`身份执行命令的，可以使用一下命令，将用户添加到`sudo`附加组中

`sudo usermod -G sudo 用户名`

但是需要注意的是设置之后，需要重新登录才能生效

### which 

> + /etc/passwd 是用于保护用户信息的文件
> + /etc/bin/passwd 是用于修改用户密码的程序

`which` 命令可以查看执行命令所在的位置，例如
```
which ls 

# 输出是
# /bin/ls

which useradd

# 输出是
# /usr/sbin/useradd

```

#### `bin` 和 `sbin`

+ 在Linux中，绝大多数而可执行文件都是保存在`/bin`  `/sbin` `/usr/bin` `/usr/sbin`
+ `/bin` (binary) 是二进制执行文件目录，主要用于具体应用
+ `/sbin` (system binary)是系统管理员专用的二进制代码存放目录，主要用于系统管理
+ `/usr/bin` (user commands for applications) 后期安装的一些软件
+ `/usr/sbin` (super user commands for applications) 超级用户的一些管理程序

> `cd` 这个终端命令 是内置在系统内核中的，没有独立的文件，因此用`which`无法找到


## 03. 切换用户

`su - 用户名`  切换用户，并且切换目录，`-`可以切换到用户家目录，否则保持位置不变


一般情况下，直接切换root用户，需要在前面加上`sudo`， 使用当前默认的有`sudo` 权限的密码切换到root账户下，而`root`密码是随机生成的，所以一般无法直接切换

不过也可以先设置好root密码，直接输入`su -`，然后输入预先设置好的root账户密码，可以直接切换到root用户

需要注意的是使用`exit`退出用户的时候，会按照切换到顺序依次退出，直至退出Shell

## 04 修改文件权限

| 命令| 作用|
|--|--|
|chown|修改拥有者|
|chgrp|修改所属组|
|chmod|修改权限|

+ 命令格式:

```

# 修改文件|目录的拥有者
chown -R 用户名 文件名|目录名

# 递归修改文件|目录的组
# 
chgrp -R 组名  文件名|目录名

# 修改文件权限
chmod -R 755 文件名|目录名

```

+ 注意以上三个命令中的`-R`选项是用来递归修改目录下的所有文件或者子目录，意思是说，修改该文件夹下的所有文件或者子目录的权限，如果不加上这个选项，那么就单单修改这一个文件夹，该文件夹内的子目录或者文件的权限没有修改


#### `chmod` 使用数字设置权限

`chmod`在设置权限时，可以简单地使用三个数字分别对应 **拥有者/组** 和 **其他** 用户的权限

`chmod +/-rwx 文件名或目录名` 可以直接修改文件或者目录的  读|写|执行  权限，但是不能精确到  拥有者|组|其他用户


我们使用数字来代表不同的权限
`r` -> 4

`w` -> 2

`x` -> 1

这样我们用三个数字不同组合的和来单独表示一个 拥有者|所属组|其他用户的权限


| | | | | 和| |权限|
|--|--|--|--|--|--|--|
|4|2|1||7||`rwx`|
|4|2|0||6||`rw-`|
|4|0|1||5||`r-x`|
|4|0|0||4||`r--`|
|0|2|1||3||`-wx`|
|0|2|0||2||`-w-`|
|0|0|1||1||`--x`|
|0|0|0||0||`---`|

常见的数字组合有：
`777` ===> `u=rwx,g=rwx,o=rwx`
`755` ===> `u=rwx,g=rx,o=rx`
`644` ===> `u=rw,g=r,o=r`

